<ion-header class="header">
  <ion-toolbar class="header">
    <ion-title>Detalle de Mascota</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-button
    expand="block"
    fill="clear"
    (click)="volverAHome()"
    class="volver-button"
  >
    Volver ☘︎
  </ion-button>

  <ion-card *ngIf="mascota" class="ion-card">
    <img
      *ngIf="mascota.fotoUrl"
      [src]="mascota.fotoUrl"
      alt="Foto de la mascota"
      class="mascota-foto"
    />
    <ion-card-header>
      <ion-card-title>{{ mascota.nombre | capitalize }}</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div>Edad: {{ calcularEdad(mascota.fechaNacimiento) }}</div>
      <div>Sexo: {{ mascota.sexo }}</div>
      <div>Peso: {{ mascota.peso }} kg</div>
      <div>N° ficha: {{ mascota.fichaNumero }}</div>
    </ion-card-content>
  </ion-card>

  <ion-button
    expand="block"
    (click)="editarMascota()"
    fill="clear"
    class="editar-button"
  >
    Editar datos
  </ion-button>
  
  <!-- Botones para abrir modales -->
  <div class="pet-detail-actions ion-margin-bottom">
    <ion-button expand="block" (click)="abrirModalArchivos()">
      Archivos médicos
    </ion-button>
    <ion-button expand="block" color="secondary" (click)="abrirModalSintomas()">
      Síntomas
    </ion-button>
  </div>

  <!-- Recientes -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Recientes</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let item of recientes">
          <ion-label>
            <ng-container *ngIf="item.tipo === 'documento'; else sintomaTpl">
              <strong>Documento:</strong> {{ item.nombre }}<br>
              <small>{{ item.fecha | date:'short' }}</small>
            </ng-container>
            <ng-template #sintomaTpl>
              <strong>Síntoma:</strong> {{ item.descripcion | slice:0:30 }}<br>
              <small>{{ item.fecha | date:'short' }}</small>
            </ng-template>
          </ion-label>
          <ion-button *ngIf="item.tipo === 'documento'" fill="clear" (click)="abrirPDF(item.url)">
            Ver PDF
          </ion-button>
        </ion-item>
      </ion-list>
      <ion-text *ngIf="recientes.length === 0">
        <p>No hay registros recientes.</p>
      </ion-text>
    </ion-card-content>
  </ion-card>

  <ion-button
    expand="block"
    fill="clear"
    class="eliminar-button"
    (click)="confirmarEliminarMascota()"
  >
    Eliminar mascota
  </ion-button>

  <!-- Input para PDF (fuera del modal para evitar problemas de referencia) -->
  <input
    #pdfInput
    type="file"
    accept="application/pdf"
    style="display: none"
    (change)="onPDFSelected($event)"
  />
</ion-content>